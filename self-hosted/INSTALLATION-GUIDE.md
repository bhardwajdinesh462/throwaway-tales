# Complete cPanel Installation Guide

## ğŸ“‹ Requirements

- **PHP 8.0+** with extensions: pdo_mysql, json, mbstring, openssl, curl
- **MySQL 5.7+** or MariaDB 10.3+
- **cPanel** or any hosting panel with PHP and MySQL support
- **Email domain** with MX records pointing to your email provider

---

## ğŸš€ Step-by-Step Installation

### Step 1: Create Database in cPanel

1. Login to **cPanel** â†’ **MySQL Databases**
2. Create a new database (e.g., `tempmail`)
3. Create a new user with a strong password
4. Add the user to the database with **ALL PRIVILEGES**

> **Note:** Your database name will be `cpanelusername_tempmail`

### Step 2: Upload Files

1. Download or clone the `self-hosted` folder
2. Upload all files to your domain's `public_html` folder via **File Manager** or FTP
3. Set folder permissions:
   ```
   chmod 755 api/
   chmod 755 uploads/
   chmod 755 uploads/attachments/
   chmod 755 uploads/avatars/
   chmod 644 .htaccess
   chmod 644 api/.htaccess
   ```

### Step 3: Run Installation Wizard

1. Visit: `https://yourdomain.com/install.php`
2. Follow the 5-step wizard:
   - **Step 1:** Enter database credentials
   - **Step 2:** Set site URL, domain, and admin account
   - **Step 3:** Configure SMTP (optional but recommended)
   - **Step 4:** Configure IMAP (optional)
   - **Step 5:** Review and install

### Step 4: Add Email Domain

In the installation wizard, enter your email domain (e.g., `tempmail.com`).

**DNS Configuration Required:**
```
MX Record: @ â†’ mail.yourdomain.com (Priority: 10)
A Record: mail â†’ Your Server IP
```

### Step 5: Configure Email Delivery

Choose ONE method:

#### Option A: Webhooks (Recommended - Instant Delivery)

1. Sign up at [ForwardEmail.net](https://forwardemail.net) or Mailgun
2. Add your domain and verify DNS
3. Create a webhook pointing to:
   ```
   https://yourdomain.com/api/emails/webhook.php
   ```
4. Copy the webhook secret to **Settings** page

#### Option B: IMAP Polling

1. Create a catch-all email account in cPanel â†’ **Email Accounts**
2. Configure IMAP settings in the installation wizard or **Settings** page
3. Set up the IMAP cron job (see Step 6)

### Step 6: Set Up Cron Jobs

Go to **cPanel** â†’ **Cron Jobs** and add:

```bash
# Cleanup expired emails (every 5 minutes)
*/5 * * * * /usr/bin/php /home/username/public_html/api/cron/cleanup.php

# Session cleanup (hourly)
0 * * * * /usr/bin/php /home/username/public_html/api/cron/sessions.php

# IMAP polling (every 2 minutes - only if using IMAP)
*/2 * * * * /usr/bin/php /home/username/public_html/api/imap/poll.php
```

Replace `/home/username/public_html` with your actual path.

---

## ğŸ”§ Post-Installation

### Access Admin Pages

| Page | URL |
|------|-----|
| Health Dashboard | `/health-dashboard.php` |
| Settings | `/settings.php` |
| Analytics | `/analytics.php` |
| Cron Manager | `/cron-manager.php` |
| Setup Wizard | `/setup-wizard.php` (locked after install) |

### Security Checklist

- [ ] Delete `install.php` after installation
- [ ] Verify `.htaccess` files are working
- [ ] Test email generation on homepage
- [ ] Check Health Dashboard for any issues
- [ ] Verify cron jobs are running

---

## â“ Troubleshooting

### "Email not generating"
1. Check **Health Dashboard** â†’ Database status
2. Verify domains exist in database
3. Run: `SELECT * FROM domains WHERE is_active = 1`

### "Admin login not working"
1. Check `users` table has your admin account
2. Verify `user_roles` table has admin role assigned
3. Clear browser cookies and try again

### "Webhooks not receiving emails"
1. Check webhook URL is accessible publicly
2. Verify webhook secret matches provider settings
3. Check **Health Dashboard** â†’ Webhook status

### "IMAP not polling"
1. Verify PHP IMAP extension is installed: `php -m | grep imap`
2. Test IMAP connection in **Settings** page
3. Check cron job is running in **Cron Manager**

---

## ğŸ“ File Structure

```
public_html/
â”œâ”€â”€ api/
â”‚   â”œâ”€â”€ config.php          # Generated by installer
â”‚   â”œâ”€â”€ core/               # Core PHP classes
â”‚   â”œâ”€â”€ auth/               # Authentication endpoints
â”‚   â”œâ”€â”€ emails/             # Email API endpoints
â”‚   â”œâ”€â”€ cron/               # Cron job scripts
â”‚   â””â”€â”€ imap/               # IMAP polling
â”œâ”€â”€ database/
â”‚   â”œâ”€â”€ schema.mysql.sql    # Database schema
â”‚   â””â”€â”€ migrations/         # Version migrations
â”œâ”€â”€ uploads/                # File uploads
â”œâ”€â”€ install.php             # Installation wizard
â”œâ”€â”€ setup-wizard.php        # Diagnostics tool
â”œâ”€â”€ settings.php            # Settings page
â”œâ”€â”€ health-dashboard.php    # Health monitoring
â”œâ”€â”€ analytics.php           # Email analytics
â”œâ”€â”€ cron-manager.php        # Cron job manager
â””â”€â”€ .htaccess               # Apache configuration
```

---

## ğŸ†˜ Getting Help

1. Check the **Health Dashboard** for real-time status
2. Review **Cron Manager** for job errors
3. Check PHP error logs in cPanel â†’ **Error Log**
4. Verify all file permissions are correct

For issues, provide:
- PHP version (`php -v`)
- MySQL version
- Error messages from Health Dashboard
- Recent entries from Cron Manager
